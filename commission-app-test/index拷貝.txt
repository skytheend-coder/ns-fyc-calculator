<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>業績計算機 - 前豐小工具</title>
    <script>
        document.write('<script src="rates.js?v=' + Date.now() + '"><\/script>');
    </script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans TC", sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;

        const Icon = ({ name, size = 16, className = "" }) => {
            const ref = useRef(null);
            const iconName = name.replace(/([A-Z])/g, "-$1").toLowerCase().replace(/^-/, "");
            useEffect(() => {
                if (window.lucide && ref.current) {
                    ref.current.innerHTML = `<i data-lucide="${iconName}"></i>`;
                    window.lucide.createIcons({ nameAttr: 'data-lucide', root: ref.current });
                    const svg = ref.current.querySelector('svg');
                    if (svg) {
                        svg.style.width = `${size}px`; svg.style.height = `${size}px`;
                        if (className) className.split(' ').forEach(cls => cls && svg.classList.add(cls));
                    }
                }
            }, [name, size, className]);
            return <span ref={ref} className={`inline-block align-middle leading-none ${className}`} style={{ width: size, height: size }}></span>;
        };

        const generateId = () => typeof crypto !== 'undefined' && crypto.randomUUID ? crypto.randomUUID() : Date.now() + Math.random();

        const App = () => {
            const [db, setDb] = useState([]);
            const [age, setAge] = useState('32');
            const [currency, setCurrency] = useState('TWD');
            const [rows, setRows] = useState([{ id: generateId(), code: '', term: '', premium: '' }]);
            const [showCashBonus, setShowCashBonus] = useState(true);
            const [showImportModal, setShowImportModal] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [importText, setImportText] = useState('');

            useEffect(() => {
                const loadData = () => {
                    if (window.PRODUCT_RATES && window.PRODUCT_RATES.length > 0) {
                        setDb([...window.PRODUCT_RATES]);
                        return true;
                    }
                    return false;
                };
                if (!loadData()) {
                    const timer = setInterval(() => { if (loadData()) clearInterval(timer); }, 200);
                    return () => clearInterval(timer);
                }
            }, []);

            const dmMap = useMemo(() => {
                const map = {};
                db.forEach(p => { if (p.dmUrl && !map[p.code]) map[p.code] = p.dmUrl; });
                return map;
            }, [db]);

            const groupedProducts = useMemo(() => {
                const groups = {
                    'LIFE': { label: '利變型壽險', color: 'bg-blue-100 text-blue-700', icon: 'Gem' },
                    'FIXED': { label: '固定型壽險', color: 'bg-red-100 text-red-600', icon: 'PlusSquare' },
                    'PA': { label: '意外傷害險', color: 'bg-amber-100 text-amber-700', icon: 'Activity' },
                    'HI': { label: '住院手術醫療', color: 'bg-rose-100 text-rose-700', icon: 'HeartPulse' },
                    'CA': { label: '癌症重大傷病', color: 'bg-purple-100 text-purple-700', icon: 'AlertTriangle' },
                    'LTC': { label: '長期照顧保險', color: 'bg-emerald-100 text-emerald-700', icon: 'Shield' },
                    'INVEST': { label: '投資型/年金', color: 'bg-orange-100 text-orange-700', icon: 'DollarSign' },
                    'TOPIC': { label: '特定議題/其他', color: 'bg-indigo-100 text-indigo-700', icon: 'Star' }
                };
                const results = {};
                Object.keys(groups).forEach(key => results[key] = { ...groups[key], items: [] });
                db.forEach(p => { if (results[p.cat] && !results[p.cat].items.includes(p.code)) results[p.cat].items.push(p.code); });
                return results;
            }, [db]);

            const calculateRowResult = (row, userAge) => {
                const p = parseFloat(row.premium) || 0;
                const inputCode = (row.code || '').trim().toUpperCase();
                if (!inputCode) return { valid: false, reason: 'empty', availableTerms: [] };
                let matched = db.filter(r => r.code === inputCode || (r.alias && r.alias.includes(inputCode)));
                if (matched.length === 0 && inputCode.length >= 2) matched = db.filter(r => r.code.includes(inputCode));
                const currencyMatched = matched.filter(r => currency === 'USD' ? r.code.includes('U') : !r.code.includes('U'));
                if (matched.length > 0 && currencyMatched.length === 0) return { valid: false, reason: 'currency_mismatch', availableTerms: [] };
                if (matched.length === 0) return { valid: false, reason: 'code', availableTerms: [] };
                const finalMatches = currencyMatched.length > 0 ? currencyMatched : matched;
                const availableTerms = [...new Set(finalMatches.map(m => String(m.term)))].sort((a, b) => parseInt(a) - parseInt(b));
                const cat = finalMatches[0]?.cat || 'TOPIC';
                if (!row.term) return { valid: false, reason: 'term', availableTerms, category: cat, matchedCode: finalMatches[0].code };
                const termMatched = finalMatches.filter(r => String(r.term) === String(row.term));
                const rate = termMatched.find(r => userAge >= r.minAge && userAge <= r.maxAge);
                if (!rate) {
                    const maxLimit = Math.max(...termMatched.map(r => r.maxAge));
                    return { valid: false, reason: userAge > maxLimit ? 'age_over' : 'age_under', limit: maxLimit, category: cat, availableTerms };
                }
                const fyc = p * (rate.fycRate / 100);
                const weight = (function(c, t){
                    const tv = parseInt(t);
                    if (['PA', 'HI', 'LTC', 'CA', 'TOPIC'].includes(c)) return (tv === 2) ? 0.6 : 3.0;
                    if (['LIFE', 'FIXED', 'INVEST'].includes(c)) {
                        if (tv === 1) return 0.05; if (tv === 2) return 0.2; if (tv === 3) return 0.3;
                        if (tv === 6) return 1.0; if (tv >= 10 && tv < 20) return 2.0; if (tv >= 20) return 3.0;
                    }
                    return 1.0;
                })(rate.cat, rate.term);
                return { fyc, marketing: p * (rate.marketingRate / 100), cash: showCashBonus ? fyc * 0.1 : 0, total: fyc + (p * (rate.marketingRate / 100)) + (showCashBonus ? fyc * 0.1 : 0), weightedValue: p * weight, weightedRate: Math.round(weight * 100), valid: true, fycRate: rate.fycRate, marketingRate: rate.marketingRate, category: rate.cat, matchedCode: rate.code, availableTerms, premium: p, term: rate.term };
            };

            const updateRow = (id, field, value) => {
                setRows(prev => prev.map(r => {
                    if (r.id !== id) return r;
                    const updated = { ...r, [field]: value };
                    if (field === 'code') {
                        const input = value.trim().toUpperCase();
                        const matched = db.filter(item => (item.code === input || (item.alias && item.alias.includes(input))) && (currency === 'USD' ? item.code.includes('U') : !item.code.includes('U')));
                        const available = [...new Set(matched.map(m => String(m.term)))];
                        updated.term = available.length === 1 ? available[0] : '';
                    }
                    return updated;
                }));
            };

            const handleImport = () => {
                try {
                    const normalized = importText.replace(/,/g, '').replace(/（/g, '(').replace(/）/g, ')');
                    const lines = normalized.split('\n');
                    const tempRows = [];
                    const allMatches = [];
                    db.forEach(r => {
                        allMatches.push({ code: r.code, official: r.code });
                        if (r.alias) r.alias.forEach(a => allMatches.push({ code: a, official: r.code }));
                    });
                    const sortedMatches = [...new Map(allMatches.map(m => [m.code, m])).values()].sort((a, b) => b.code.length - a.code.length);
                    let detectedCurrency = null;
                    for (let line of lines) {
                        const found = sortedMatches.find(m => line.toUpperCase().includes(m.code));
                        if (found) { detectedCurrency = found.official.includes('U') ? 'USD' : 'TWD'; break; }
                    }
                    if (detectedCurrency) setCurrency(detectedCurrency);
                    lines.forEach((line, idx) => {
                        const upperLine = line.toUpperCase().trim();
                        let found = sortedMatches.find(m => upperLine.includes(m.code));
                        if (found) {
                            let term = '';
                            const matchT = upperLine.match(/(?:(\d+)\s*${found.code})|(?:${found.code}\s*[\u4e00-\u9fa5]*\s*(\d+))/);
                            if (matchT) term = matchT[1] || matchT[2];
                            let searchArea = lines.slice(idx, idx + 10).join('\n');
                            const cleanArea = searchArea.replace(/\d+[,]?\d*\s*(?:元|萬元|計劃|份)/g, '');
                            const nums = (cleanArea.match(/\d+[,]?\d*/g) || []).map(n => n.replace(/,/g, '')).map(Number);
                            let premium = '';
                            for (let i = 0; i < nums.length - 1; i++) { if (nums[i] > 500 && nums[i] === nums[i+1]) { premium = nums[i].toString(); break; } }
                            if (!premium) premium = nums.find(n => n > 500) || '';
                            if (!term) { const termNums = (searchArea.match(/\d+/g) || []).map(Number); term = termNums.find(n => n > 0 && n <= 30) || ''; }
                            if (premium) tempRows.push({ id: generateId(), code: found.official, term: String(term), premium });
                        }
                    });
                    if (tempRows.length > 0) { setRows(tempRows); setShowImportModal(false); setImportText(''); }
                    else alert('辨識失敗');
                } catch (e) { alert('導入錯誤'); }
            };

            const calculatedRows = useMemo(() => rows.map(r => ({ ...r, result: calculateRowResult(r, parseInt(age) || 0) })), [rows, age, db, currency, showCashBonus]);
            const totals = useMemo(() => calculatedRows.reduce((acc, item) => {
                const pValue = parseFloat(item.premium) || 0;
                return { 
                    fyc: acc.fyc + (item.result.valid ? item.result.fyc : 0), 
                    marketing: acc.marketing + (item.result.valid ? item.result.marketing : 0), 
                    cash: acc.cash + (item.result.valid ? item.result.cash : 0), 
                    total: acc.total + (item.result.valid ? item.result.total : 0),
                    premiumTotal: acc.premiumTotal + pValue,
                    weightedTotal: acc.weightedTotal + (item.result.valid ? item.result.weightedValue : 0)
                };
            }, { fyc: 0, marketing: 0, cash: 0, total: 0, premiumTotal: 0, weightedTotal: 0 }), [calculatedRows]);

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 text-slate-900 leading-normal font-medium flex flex-col">
                    <div className="max-w-7xl mx-auto flex-grow w-full">
                        {/* Header */}
                        <div className="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-10">
                            <div className="flex items-center gap-4">
                                <div className="bg-indigo-600 p-4 rounded-[1.5rem] shadow-xl text-white"><Icon name="Calculator" size={32} /></div>
                                <div><h1 className="text-3xl font-black tracking-tighter leading-none">業績計算機</h1><p className="text-slate-400 font-bold uppercase tracking-widest text-[10px] mt-2 underline decoration-indigo-200 decoration-2">前豐小工具</p></div>
                            </div>
                            <div className="flex flex-wrap items-center gap-4">
                                <div className="bg-white p-1 rounded-2xl shadow-sm border border-slate-100 flex items-center">
                                    <button onClick={() => setCurrency('TWD')} className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${currency === 'TWD' ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-400 hover:bg-slate-50'}`}>台幣</button>
                                    <button onClick={() => setCurrency('USD')} className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${currency === 'USD' ? 'bg-amber-500 text-white shadow-md' : 'text-slate-400 hover:bg-slate-50'}`}>美元</button>
                                </div>
                                <div className="bg-white px-8 py-4 rounded-[2rem] shadow-sm border border-slate-100 flex items-center gap-6">
                                    <div className="space-y-0.5 text-center"><p className="text-[10px] font-bold text-slate-300 uppercase">客戶年齡</p><div className="flex items-center gap-2"><input type="number" value={age} onChange={(e) => setAge(e.target.value)} className="w-16 bg-transparent border-none p-0 text-3xl font-black text-indigo-600 text-center outline-none focus:ring-0" /><span className="text-slate-400 text-xl font-bold">歲</span></div></div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 xl:grid-cols-12 gap-8">
                            {/* Left Panel */}
                            <div className="xl:col-span-7 space-y-6">
                                <div className="bg-white rounded-[2.5rem] shadow-sm border border-slate-100 p-6 md:p-8 space-y-6">
                                    <div className="flex justify-between items-center border-b border-slate-50 pb-4">
                                        <div className="flex items-center gap-3">
                                            <h2 className="text-lg font-bold flex items-center gap-2 text-slate-800"><Icon name="ClipboardList" className="text-indigo-500" /> 建議書內容</h2>
                                            <button onClick={() => setShowResetModal(true)} className="text-[10px] bg-slate-100 text-slate-500 px-3 py-1 rounded-full hover:bg-rose-50 hover:text-rose-500 transition-all font-bold">全部清除</button>
                                        </div>
                                        <button onClick={() => setShowImportModal(true)} className="flex items-center gap-2 px-4 py-2 bg-indigo-50 text-indigo-600 rounded-full text-xs font-bold hover:bg-indigo-100 shadow-sm transition-transform active:scale-95"><Icon name="FileText" size={14} /> 智慧導入</button>
                                    </div>
                                    <div className="space-y-4">
                                        {calculatedRows.map((item) => {
                                            const calc = item.result;
                                            const groupInfo = (calc.category && groupedProducts[calc.category]) ? groupedProducts[calc.category] : { color: 'bg-slate-100 text-slate-500', icon: 'HelpCircle' };
                                            return (
                                                <div key={item.id} className={`relative grid grid-cols-12 gap-3 items-center p-4 rounded-[2rem] border-2 transition-all ${calc.valid ? 'bg-indigo-50/20 border-indigo-100 shadow-sm' : 'border-slate-100 bg-white'}`}>
                                                    <div className="col-span-11 md:col-span-4 relative">
                                                        <input type="text" placeholder="代碼" value={item.code} onChange={(e) => updateRow(item.id, 'code', e.target.value)} className="w-full bg-white border-none rounded-xl py-3 px-4 font-medium uppercase outline-none shadow-inner" />
                                                        {item.code && (
                                                            <div className="absolute -bottom-2 left-4 z-10">
                                                                {calc.valid ? <span className={`flex items-center gap-1 text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm border ${groupInfo.color}`}><Icon name={groupInfo.icon} size={14} /> {calc.matchedCode}</span> : 
                                                                <span className="text-[10px] text-rose-500 bg-white px-2 py-0.5 rounded-full border border-rose-100 shadow-sm whitespace-nowrap">{calc.reason === 'currency_mismatch' ? `幣別不符` : calc.reason === 'term' ? `選年期` : `無此代碼`}</span>}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <div className="col-span-1 md:hidden flex justify-end"><button onClick={() => setRows(rows.filter(r => r.id !== item.id))} className="text-slate-300 p-1"><Icon name="XCircle" size={18} /></button></div>
                                                    <div className="col-span-6 md:col-span-3">
                                                        <select value={String(item.term)} onChange={(e) => updateRow(item.id, 'term', e.target.value)} className="w-full bg-white border-none rounded-xl py-3 px-3 text-center font-medium outline-none shadow-inner cursor-pointer appearance-none text-sm">
                                                            <option value="">年期</option>
                                                            {calc.availableTerms?.map(t => <option key={t} value={t}>{t}年期</option>)}
                                                        </select>
                                                    </div>
                                                    <div className="col-span-6 md:col-span-4 relative">
                                                        <Icon name="DollarSign" size={14} className={`absolute left-4 top-1/2 -translate-y-1/2 ${currency === 'USD' ? 'text-amber-500' : 'text-slate-300'}`} />
                                                        <input type="number" placeholder="保費" value={item.premium} onChange={(e) => updateRow(item.id, 'premium', e.target.value)} className="w-full pl-10 pr-4 py-3 bg-white border-none rounded-xl font-medium outline-none shadow-inner text-sm" />
                                                    </div>
                                                    <div className="hidden md:flex md:col-span-1 justify-center"><button onClick={() => setRows(rows.filter(r => r.id !== item.id))} className="p-2 text-slate-200 hover:text-rose-500 transition-all"><Icon name="XCircle" size={20} /></button></div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                    <button onClick={() => setRows([...rows, { id: generateId(), code: '', term: '', premium: '' }])} className="w-full py-5 border-2 border-dashed border-slate-200 rounded-[2.5rem] text-slate-300 font-bold flex justify-center items-center gap-2 hover:border-indigo-200 hover:text-indigo-400 transition-all"><Icon name="Plus" size={20} /> 新增項目</button>
                                </div>
                            </div>

                            {/* Right Panel */}
                            <div className="xl:col-span-5 space-y-6">
                                <div className="bg-slate-900 rounded-[3rem] p-8 text-white shadow-2xl relative overflow-hidden">
                                    <div className="absolute top-6 right-8 flex items-center gap-2 z-20 font-bold text-[9px]"><p className="text-slate-500 uppercase tracking-tighter">10% 獎勵</p><button onClick={() => setShowCashBonus(!showCashBonus)} className={`w-10 h-5 rounded-full relative transition-all ${showCashBonus ? 'bg-indigo-600' : 'bg-slate-700'}`}><div className={`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${showCashBonus ? 'left-6' : 'left-1'}`}></div></button></div>
                                    <div className="text-center py-6">
                                        <p className="text-indigo-400 font-bold text-[10px] uppercase tracking-[0.4em] mb-3">總預估收益 ({currency})</p>
                                        <div className="text-6xl font-black mb-1">${Math.round(totals.total).toLocaleString()}</div>
                                        <p className="text-slate-400 text-[10px] font-bold mt-2 opacity-80">數字僅供參考，實際獎金以公司發放之數額為準</p>
                                        <p className="text-slate-500 text-xs font-bold tracking-tight mt-4">建議書總保費: ${Math.round(totals.premiumTotal).toLocaleString()}</p>
                                    </div>
                                    <div className="mt-6 pt-6 border-t border-slate-800 space-y-4 font-bold">
                                        <div className="flex justify-between items-center px-2"><span>首年 FYC</span><span>{currency === 'USD' ? 'US$' : '$'}{Math.round(totals.fyc).toLocaleString()}</span></div>
                                        <div className="flex justify-between items-center px-2"><span>行銷獎金</span><span>{currency === 'USD' ? 'US$' : '$'}{Math.round(totals.marketing).toLocaleString()}</span></div>
                                        {showCashBonus && <div className="flex justify-between items-center px-2 text-indigo-400 font-bold"><span>現金獎勵 (預估)</span><span>{currency === 'USD' ? 'US$' : '$'}{Math.round(totals.cash).toLocaleString()}</span></div>}
                                        <div className="grid grid-cols-2 gap-4 mt-8 text-center">
                                            <div className="bg-indigo-500/10 border border-indigo-500/20 rounded-2xl p-4"><p className="text-indigo-400 text-[9px] uppercase mb-1 font-bold">加權業績 (V)</p><span className="text-2xl font-black text-indigo-200 block">{Math.round(totals.weightedTotal).toLocaleString()}</span></div>
                                            <div className="bg-emerald-500/10 border border-emerald-500/20 rounded-2xl p-4"><p className="text-emerald-400 text-[9px] uppercase mb-1 font-bold">收益比 (ROI)</p><span className="text-2xl font-black text-emerald-400 block">{totals.premiumTotal > 0 ? (totals.total / totals.premiumTotal * 100).toFixed(1) : 0}%</span></div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white rounded-[2.5rem] p-6 md:p-8 shadow-sm border border-slate-100">
                                    <h3 className="text-lg font-bold flex items-center gap-2 mb-6 border-b border-slate-50 pb-4"><Icon name="PieChart" className="text-indigo-500" /> 商品收益明細</h3>
                                    <div className="space-y-4 max-h-[350px] overflow-y-auto pr-1 scrollbar-hide text-balance">
                                        {calculatedRows.filter(i => i.result.valid).map(item => (
                                            <div key={item.id} className="p-4 bg-slate-50 rounded-[1.5rem] border border-slate-100 space-y-3 font-bold text-sm">
                                                <div className="flex justify-between items-center">
                                                    <div className="flex items-center gap-2">
                                                        <a href={dmMap[item.result.matchedCode] || '#'} target="_blank" rel="noopener noreferrer" className={`${currency === 'USD' ? 'bg-amber-500' : 'bg-indigo-600'} text-white text-[10px] px-2 py-0.5 rounded font-bold hover:opacity-80 transition-all ${dmMap[item.result.matchedCode] ? 'cursor-pointer underline decoration-white/50' : 'cursor-default'}`} onClick={(e) => !dmMap[item.result.matchedCode] && e.preventDefault()}>
                                                            {item.result.matchedCode}
                                                        </a>
                                                        <span className="text-[10px] text-slate-400">{item.result.term}年期</span>
                                                    </div>
                                                    <div className="text-right"><p className="text-[8px] text-indigo-500 font-bold uppercase">加權</p><p className="text-xs">{Math.round(item.result.weightedValue).toLocaleString()} ({item.result.weightedRate}%)</p></div>
                                                </div>
                                                <div className="grid grid-cols-3 gap-2 border-t border-slate-200 pt-3 text-center">
                                                    <div><p className="text-[8px] text-slate-400 uppercase">FYC ({item.result.fycRate}%)</p><p className="text-xs">{currency === 'USD' ? 'US$' : '$'}{Math.round(item.result.fyc).toLocaleString()}</p></div>
                                                    <div><p className="text-[8px] text-slate-400 uppercase">行銷</p><p className="text-xs">{currency === 'USD' ? 'US$' : '$'}{Math.round(item.result.marketing).toLocaleString()}</p></div>
                                                    <div className="text-right"><p className="text-[8px] text-indigo-400 font-bold">合計</p><p className="text-xs text-indigo-600">{currency === 'USD' ? 'US$' : '$'}{Math.round(item.result.total).toLocaleString()}</p></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-white rounded-[2.5rem] p-6 md:p-8 shadow-sm border border-slate-100">
                                    <div className="flex items-center gap-3 border-b border-indigo-100 pb-3 mb-6 font-black"><Icon name="Info" size={24} className="text-indigo-500" /><p className="text-sm font-bold text-indigo-900">資料庫收錄 ({currency})</p></div>
                                    <div className="space-y-4 max-h-[300px] overflow-y-auto pr-2 scrollbar-hide text-balance">
                                        {Object.entries(groupedProducts).map(([key, group]) => {
                                            const filteredItems = group.items.filter(code => {
                                                const product = db.find(p => p.code === code);
                                                return currency === 'USD' ? product?.code.includes('U') : !product?.code.includes('U');
                                            });
                                            return filteredItems.length > 0 && (
                                                <div key={key} className="space-y-2">
                                                    <div className="flex items-center gap-2">
                                                        <div className={`p-1.5 rounded-lg ${group.color}`}><Icon name={group.icon} size={12} /></div>
                                                        <p className="text-[10px] font-bold text-slate-700 uppercase">{group.label}</p>
                                                    </div>
                                                    <div className="flex flex-wrap gap-1.5 pl-8">
                                                        {filteredItems.map(code => (
                                                            <a key={code} href={dmMap[code] || '#'} target="_blank" rel="noopener noreferrer" className={`text-[9px] font-bold px-2 py-0.5 rounded border transition-all ${dmMap[code] ? 'bg-white text-indigo-600 border-indigo-200 hover:bg-indigo-50 cursor-pointer underline' : 'bg-slate-50 text-slate-400 border-slate-100 cursor-default'}`} onClick={(e) => !dmMap[code] && e.preventDefault()}>{code}</a>
                                                        ))}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="mt-12 mb-6 text-center text-slate-400">
                        <p className="text-[10px] font-bold tracking-widest">made by 小夏，有任何問題請回報</p>
                    </footer>

                    {/* Reset Modal */}
                    {showResetModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[60] flex items-center justify-center p-4 text-center leading-normal">
                            <div className="bg-white rounded-[2.5rem] w-full max-w-sm p-8 shadow-2xl space-y-6">
                                <div className="w-16 h-16 bg-rose-50 text-rose-500 rounded-full flex items-center justify-center mx-auto"><Icon name="AlertTriangle" size={32} /></div>
                                <div className="space-y-2"><h3 className="text-xl font-black text-slate-800 text-balance">確定要全部清除嗎？</h3><p className="text-sm text-slate-400 font-bold">此操作將移除所有已輸入項目。</p></div>
                                <div className="flex gap-3"><button onClick={() => setShowResetModal(false)} className="flex-1 py-3 bg-slate-50 text-slate-400 rounded-xl font-bold">取消</button><button onClick={() => { setRows([{ id: generateId(), code: '', term: '', premium: '' }]); setShowResetModal(false); }} className="flex-1 py-3 bg-rose-500 text-white rounded-xl font-bold shadow-md">清除</button></div>
                            </div>
                        </div>
                    )}

                    {/* Import Modal */}
                    {showImportModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 leading-normal">
                            <div className="bg-white rounded-[2.5rem] w-full max-w-lg p-8 shadow-2xl space-y-6">
                                <div className="flex justify-between items-center"><h3 className="text-2xl font-black">建議書文字導入</h3><button onClick={() => setShowImportModal(false)} className="text-slate-300 hover:text-slate-500"><Icon name="X" size={24} /></button></div>
                                <textarea className="w-full h-48 bg-slate-50 border-2 border-slate-100 rounded-[1.5rem] p-4 outline-none focus:border-indigo-200 font-mono text-xs resize-none" placeholder="請框選保費明細表文字並貼上..." value={importText} onChange={(e) => setImportText(e.target.value)} />
                                <div className="flex gap-4"><button onClick={() => setShowImportModal(false)} className="flex-1 py-4 bg-slate-100 text-slate-500 rounded-2xl font-bold">取消</button><button onClick={handleImport} className="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg hover:bg-indigo-700 transition-all leading-none active:scale-95">開始辨識導入</button></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
